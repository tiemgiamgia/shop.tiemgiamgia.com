---
export const prerender = false;

import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";

const { slug } = Astro.params;

/* ✅ Worker-safe JSON fetch */
const res = await fetch(`${Astro.request.url.origin}/index.json`);
const products = await res.json();

const product = products.find(p => p.slug === slug);

if (!product) {
  return Astro.redirect("/404");
}

const price = Number(product.price || 0).toLocaleString("vi-VN") + "₫";
---

<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>{product.title}</title>
  <meta name="description" content={product.title}>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/site.css">
</head>

<body>

  <Header />

  <div class="page">
    <div class="product">

      <img src={product.image} alt={product.title}>

      <h1>{product.title}</h1>

      <div class="price">{price}</div>

    </div>
  </div>

  <Footer />

</body>
</html>